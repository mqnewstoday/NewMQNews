<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="ALT_LogoMQN.png" type="image/png">
    <link rel="shortcut icon" href="ALT_LogoMQN.png" type="image/png">
    <title>MQ News Today</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Merriweather:wght@300;400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="theme.css">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="LogoMQN144.png" sizes="any">

    <meta name="theme-color" content="#9d1b1b">

    <link rel="apple-touch-icon" href="ALT_LogoMQN.png">

    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="MQ News Today - Truth & Clarity">
    <meta property="og:description" content="Berita dan Analisis Mendalam seputar Geopolitik, Eskatologi, dan Islam.">
    <meta property="og:image" content="ALT_LogoMQN.png">
    <meta property="og:url" content="">
    <meta property="og:type" content="website">
</head>

<body>
    <script src="theme-init.js"></script>
    <header>

        <div class="brand">
            <img src="ALT_LogoMQN.png" alt="Logo MQ" onerror="this.style.display='none'">
            <div class="brand-text">
                <h1>MQ News Today</h1>
                <span>Truth & Clarity</span>
            </div>
        </div>
        <div class="menu-toggle" onclick="toggleSidebar()">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </header>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="search-box">
                <svg class="search-icon" viewBox="0 0 24 24" onclick="executeSearch()" title="Cari Berita">
                    <path
                        d="M21.71 20.29l-5.01-5.01C17.54 13.68 18 11.91 18 10c0-4.41-3.59-8-8-8S2 5.59 2 10s3.59 8 8 8c1.91 0 3.68-.46 5.28-1.3l5.01 5.01c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.42zM4 10c0-3.31 2.69-6 6-6s6 2.69 6 6-2.69 6-6 6-6-2.69-6-6z" />
                </svg>
                <input type="text" id="searchInput" class="search-input" placeholder="Cari berita..."
                    onkeypress="handleEnterKey(event)">
            </div>
            <div class="close-sidebar-btn" onclick="toggleSidebar()">×</div>
        </div>

        <div class="sidebar-menu">
            <a href="#" onclick="toggleSidebar(); setCategory(null, 'Semua')">BERANDA</a>
            <a href="https://muhammadqasimpk.org/id" target="_blank">MUHAMMAD QASIM OFFICIAL</a>
            <a href="https://casereportsinregrowth.com" target="_blank">MUKJIZAT</a>
            <a href="https://saweria.co/mqnewstoday" target="_blank">SUPPORT ME</a>
        </div>

        <div class="auth-bottom-wrapper">
            <a href="#" id="logout-btn" class="logout-link-small" style="display: none;">
                KELUAR / LOGOUT ›
            </a>

            <a href="login.html" id="auth-link" class="profile-btn">
                <span id="auth-text">MASUK / DAFTAR</span>
            </a>
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <!-- CUSTOM NOTIFICATION BOX -->
    <div id="notifBox" class="custom-notif">
        <div id="notifIcon" class="notif-icon"></div>
        <span id="notifText" class="notif-text">Pesan notifikasi...</span>
    </div>

    <div id="home-view">
        <div class="category-nav">
            <div class="nav-inner" id="nav-container">
                <a onclick="setCategory(null, 'Semua')" class="cat-link active">Semua</a>
                <a onclick="setCategory(null, 'Geopolitik')" class="cat-link">Geopolitik</a>
                <a onclick="setCategory(null, 'Eskatologi')" class="cat-link">Eskatologi</a>
                <a onclick="setCategory(null, 'Mimpi Qasim')" class="cat-link">Mimpi Qasim</a>
                <a onclick="setCategory(null, 'Timur Tengah')" class="cat-link">Timur Tengah</a>
                <a onclick="setCategory(null, 'Trending')" class="cat-link">Trending</a>
            </div>
        </div>

        <div class="date-header-container">
            <div id="live-date" class="live-date-text">Memuat Waktu...</div>

            <svg class="date-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" />
            </svg>
        </div>


        <div id="banner-container" class="showcase-wrapper" style="display: none;">
            <div class="showcase-strip" id="banner-track">
            </div>
        </div>


        <div class="quick-menu-grid">

            <a href="buku.html" class="menu-item">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                    </svg>
                </div>
                <span class="menu-label">PDF</span>
            </a>

            <a href="pesan-tauhid.html" class="menu-item">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                    </svg>
                </div>
                <span class="menu-label">19 PESAN</span>
            </a>

            <a href="audio.html" class="menu-item">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
                        <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3z"></path>
                        <path d="M3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>
                    </svg>
                </div>
                <span class="menu-label">AUDIO</span>
            </a>


            <button class="menu-item" onclick="toggleMoreMenu()" id="btnMore">
                <div class="icon-box">
                    <svg id="iconMore" viewBox="0 0 24 24">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                </div>
                <span class="menu-label" id="textMore">LAINNYA</span>
            </button>

            <a href="simpan.html" class="menu-item hidden-row">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                    </svg>
                </div>
                <span class="menu-label">TERSIMPAN</span>
            </a>

            <!-- MUBASYIRAT (Pindah ke Hidden Row) -->
            <a href="pramimpi.html" class="menu-item hidden-row">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z">
                        </path>
                    </svg>
                </div>
                <span class="menu-label">MUBASYIRAT</span>
            </a>

            <a href="https://chat.whatsapp.com/Cb6nVjlAtj06JRdeFzRpKw" class="menu-item hidden-row">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                </div>
                <span class="menu-label">JOIN GRUP</span>
            </a>

            <button class="menu-item hidden-row" id="installBtn">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </div>
                <span class="menu-label">INSTALL APP</span>
            </button>

            <a href="https://saweria.co/mqnewstoday" target="_blank" class="menu-item hidden-row">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path d="M18 8h1a4 4 0 0 1 0 8h-1"></path>
                        <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path>
                        <line x1="6" y1="1" x2="6" y2="4"></line>
                        <line x1="10" y1="1" x2="10" y2="4"></line>
                        <line x1="14" y1="1" x2="14" y2="4"></line>
                    </svg>
                </div>
                <span class="menu-label">SAWERIA</span>
            </a>

        </div>



        <div id="mq-quote-widget" class="mq-quote-compact" style="display:none;">
            <div class="quote-label">QUOTES OF THE END TIMES</div>

            <blockquote id="mq-quote-text">Loading...</blockquote>

            <div id="mq-quote-source">-- --</div>
        </div>





        <main class="main-container" id="mainContainer">
            <div class="section-label">
                <span id="current-category-label">Berita Terkini</span>
                <div class="section-line"></div>
            </div>
            <div id="news-container" class="news-grid">
                <div class="loader">Mengunduh data berita...</div>
            </div>
            <!-- <div id="news-container" class="news-grid"></div> -->

            <div class="related-section-wrapper">
                <div class="section-label small-label"><span>Pilihan Editor</span></div>
                <div id="home-related-list" class="related-list">
                </div>
            </div>

            <!-- MUBASYIRAT SECTION (NEW) -->
            <div class="mubasyirat-section">
                <div class="mubasyirat-title">MUBASYIRAT MUHAMMAD QASIM</div>
                <div class="dream-scroll-container" id="dream-container-scroll">
                    <div class="loader" style="width:100%; text-align:center; padding:20px;">Memuat Mubasyirat...</div>
                </div>
            </div>

            <script>
                document.addEventListener("DOMContentLoaded", () => {
                    // LINK CSV RESMI DARI USER
                    const MUBASYIRAT_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTOAltvE7tpJsTkKbqMoqLZe-7K9cGk_uPUqeigV7qvWUm5crdAiOJ_hNAvchnjNrE8cA0F-ybuZhKd/pub?gid=703095600&single=true&output=csv";

                    function renderDreams(data) {
                        const container = document.getElementById('dream-container-scroll');
                        container.innerHTML = "";
                        data.forEach(item => {
                            // Support berbagai variasi key safe
                            const getK = (obj, k) => obj[Object.keys(obj).find(key => key.toLowerCase() === k.toLowerCase())] || "";

                            const title = getK(item, 'judul') || "Tanpa Judul";
                            // Fallback thumbnail jika kosong
                            const thumb = getK(item, 'thumbnail') || "https://placehold.co/450x800?text=No+Image";
                            const date = getK(item, 'tanggal') || ""; // Tanggal mungkin kosong di CSV baru

                            const html = `
                        <div class="dream-card" onclick="window.location.href='mimpi.html?title=' + encodeURIComponent('${title}')">
                            <div class="dream-thumb">
                                <img src="${thumb}" loading="lazy" onerror="this.src='https://placehold.co/450x800?text=Error'">
                                <div class="dream-overlay"></div>
                                <div class="play-overlay">
                                    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                                </div>
                            </div>
                            <div class="dream-info">
                                <div class="dream-title">${title}</div>
                                ${date ? `<div class="dream-date">
                                    <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                                    ${date}
                                </div>` : ''}
                            </div>
                        </div>
                        `;
                            container.insertAdjacentHTML('beforeend', html);
                        });
                    }

                    if (window.Papa) {
                        Papa.parse(MUBASYIRAT_CSV_URL, {
                            download: true, header: true, skipEmptyLines: true,
                            complete: (res) => {
                                if (res.data && res.data.length > 0) renderDreams(res.data);
                                else container.innerHTML = "<div style='text-align:center;width:100%'>Belum ada data mimpi.</div>";
                            },
                            error: () => document.getElementById('dream-container-scroll').innerHTML = "<div style='text-align:center;width:100%'>Gagal memuat data.</div>"
                        });
                    }
                });
            </script>

        </main>
    </div>


    <footer>
        <div class="footer-content">
            <div class="footer-col">
                <div class="footer-logo">
                    <img src="MQ_LogoSecond.png" alt="Logo White">
                </div>
                <p>
                    MQ News Today berdedikasi untuk menyajikan informasi yang sering luput dari media arus utama.
                    Fokus pada kebenaran dan analisis mendalam.
                </p>
            </div>

            <div class="footer-col">
                <h3>Kategori</h3>
                <div class="footer-links">
                    <a href="#" onclick="setCategory(null, 'Semua')">Beranda</a>
                    <a href="#" onclick="setCategory(null, 'Geopolitik')">Geopolitik</a>
                    <a href="#" onclick="setCategory(null, 'Eskatologi')">Eskatologi</a>
                    <a href="#" onclick="setCategory(null, 'Mimpi Qasim')">Mimpi Qasim</a>
                    <a href="#" onclick="setCategory(null, 'Timur Tengah')">Timur Tengah</a>
                    <a href="#" onclick="setCategory(null, 'Trending')">Trending</a>
                </div>
            </div>

            <div class="footer-col">
                <h3>Hubungi Kami</h3>
                <a href="https://wa.me/6285705856030" target="_blank" class="footer-wa-link">
                    (+62) 857-0585-6030
                </a>
            </div>
        </div>

        <div class="social-icons-group article-mode">

            <a href="https://x.com/MQNewsToday" target="_blank" class="soc-link" aria-label="X Twitter">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
                </svg>
            </a>

            <a href="https://www.instagram.com/mqnews.today?igsh=Z2hlM3pyeno3ZDY2" target="_blank" class="soc-link"
                aria-label="Instagram">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
                </svg>
            </a>

            <a href="https://www.tiktok.com/@mqnews.today?_r=1&_t=ZS-92THjGhQHkD" target="_blank" class="soc-link"
                aria-label="TikTok">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z" />
                </svg>
            </a>

            <a href="https://www.youtube.com/@MQNewsToday" target="_blank" class="soc-link" aria-label="YouTube">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z" />
                </svg>
            </a>

        </div>


        <div class="copyright">
            <a href="tentang-kami.html" style="text-decoration: none; color: inherit;">
                © 2026 MQ News Today
            </a>
        </div>
    </footer>


    <div id="logoutModal" class="custom-modal-overlay">
        <div class="custom-modal-box">
            <h3 class="modal-title">Konfirmasi</h3>
            <p class="modal-desc">Apakah Anda yakin ingin keluar dari akun?</p>
            <div class="modal-actions">
                <button id="btnCancelLogout" class="modal-btn btn-cancel">Batal</button>
                <button id="btnConfirmLogout" class="modal-btn btn-yes">Ya, Keluar</button>
            </div>
        </div>
    </div>

    <div id="limitModal" class="custom-modal-overlay">
        <div class="custom-modal-box">
            <h3 class="modal-title" style="color: var(--primary);">Batas Akses Tamu</h3>
            <p class="modal-desc">Anda telah membaca <strong>3 berita gratis</strong>. Silakan masuk atau daftar untuk
                akses tanpa batas.</p>
            <div class="modal-actions">
                <button onclick="document.getElementById('limitModal').style.display='none'"
                    class="modal-btn btn-cancel">Nanti Saja</button>
                <button onclick="window.location.href='login.html'" class="modal-btn btn-yes">Masuk / Daftar</button>
            </div>
        </div>
    </div>

    <div id="notifBox" class="custom-notif">
        <div id="notifIcon"></div>
        <span id="notifText">Pesan notifikasi...</span>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <!-- FIREBASE INIT MODULE -->
    <script type="module">
        import { auth } from "./firebase-config.js";
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // Expose auth to global window so non-module scripts can use it
        window.auth = auth;

        // AUTH LISTENER: Update Sidebar UI
        onAuthStateChanged(auth, (user) => {
            const link = document.getElementById('auth-link');
            const text = document.getElementById('auth-text');
            const logoutBtn = document.getElementById('logout-btn');

            if (user) {
                // USER LOGIN
                const name = user.displayName || user.email.split('@')[0];
                text.innerText = "HALO, " + name.toUpperCase();
                link.href = "profil.html"; // Arahkan ke profil

                if (logoutBtn) {
                    logoutBtn.style.display = "flex";
                    logoutBtn.onclick = (e) => {
                        e.preventDefault();
                        document.getElementById('logoutModal').classList.add('active');
                    };
                }
            } else {
                // USER LOGOUT
                text.innerText = "MASUK / DAFTAR";
                link.href = "login.html";
                if (logoutBtn) logoutBtn.style.display = "none";
            }
        });

        // LOGOUT LOGIC
        document.getElementById('btnConfirmLogout').addEventListener('click', async () => {
            // FIX: Reset limit baca tamu saat logout agar user mulai dari 0 lagi sebagai tamu
            localStorage.removeItem('guest_read_count');
            sessionStorage.removeItem('last_read_url');

            await signOut(auth);
            document.getElementById('logoutModal').classList.remove('active');
            window.location.reload();
        });

        document.getElementById('btnCancelLogout').addEventListener('click', () => {
            document.getElementById('logoutModal').classList.remove('active');
        });
    </script>

    <script>
        // --- KONFIGURASI ---
        const sheetID = "1FDzhBlVOFlnlQgphN2gsGJUdDeFWonpoJcadY8JqUcM";

        // Variabel Global
        let allNews = [];         // Semua berita mentah dari CSV
        let activeData = [];      // Berita yang sedang aktif (bisa hasil search/filter)
        let currentIndex = 0;     // Posisi load berita sekarang
        const BATCH_SIZE = 9;     // Jumlah berita per load (9 berita)

        // --- 1. INIT: AMBIL DATA ---
        function init() {
            const url = `https://docs.google.com/spreadsheets/d/${sheetID}/export?format=csv`;
            Papa.parse(url, {
                download: true, header: true, skipEmptyLines: true,
                complete: function (results) {
                    allNews = results.data;
                    activeData = allNews.slice().reverse();
                    resetRender();

                    if (typeof updateClock === 'function') updateClock();
                    // Render Rekomendasi di Footer kalo perlu
                    if (typeof renderRelatedNews === 'function') setTimeout(() => renderRelatedNews('home-related-list'), 500);
                },

                error: function () {
                    document.getElementById('news-container').innerHTML = "<div class='no-data'>Gagal koneksi. Cek internet Anda.</div>";
                }
            });
        }
        // --- SCRIPT JAM REDAKSI ---
        function updateClock() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateStr = now.toLocaleDateString('id-ID', options);
            const timeStr = now.toLocaleTimeString('id-ID'); // Jam:Menit:Detik

            const el = document.getElementById('live-date');
            if (el) el.innerText = `${dateStr} | ${timeStr} WIB`;
        }
        setInterval(updateClock, 1000); // Update tiap detik
        updateClock(); // Jalanin langsung pas load

        // --- SCRIPT BANNER OTOMATIS (GOOGLE SHEET) ---
        document.addEventListener('DOMContentLoaded', () => {
            // 1. MASUKKAN LINK CSV SHEET "BANNER" LU DI SINI:
            const BANNER_SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTOAltvE7tpJsTkKbqMoqLZe-7K9cGk_uPUqeigV7qvWUm5crdAiOJ_hNAvchnjNrE8cA0F-ybuZhKd/pub?gid=530510330&single=true&output=csv";

            const container = document.getElementById('banner-container');
            const track = document.getElementById('banner-track');

            // Fungsi Parse CSV (Sama kayak berita)
            function parseCSV(text) {
                const rows = text.split('\n').slice(1); // Buang header baris 1
                return rows.map(row => {
                    // Split koma (regex ini menangani koma di dalam tanda kutip)
                    const cols = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                    if (!cols) return null;
                    return {
                        img: cols[0]?.replace(/"/g, '').trim(),
                        caption: cols[1]?.replace(/"/g, '').trim(),
                        link: cols[2]?.replace(/"/g, '').trim()
                    };
                }).filter(item => item && item.img); // Hanya ambil yg ada gambarnya
            }

            // Fungsi Render Banner (Versi Aman & Support Link Lokal)
            async function loadBanner() {
                try {
                    const res = await fetch(BANNER_SHEET_URL);
                    const text = await res.text();
                    let data = parseCSV(text); // Tetap pakai parseCSV kamu

                    // LIMIT CUMA 3 GAMBAR
                    if (data.length > 3) data = data.slice(0, 3);

                    if (data.length > 0) {
                        // Tampilkan Container
                        container.style.display = 'block';
                        track.innerHTML = ''; // Bersihkan

                        data.forEach((item, index) => {
                            const activeClass = index === 0 ? 'active' : '';

                            // --- LOGIKA BARU: CEK LINK LOKAL vs LUAR ---
                            let tag = 'div';
                            let hrefAttr = '';
                            let styleAttr = '';

                            // Cek kolom link ada isinya gak?
                            if (item.link && item.link.trim() !== '') {
                                tag = 'a'; // Jadiin link

                                // Cek apakah link luar (http) atau lokal?
                                const target = item.link.includes('http') ? '_blank' : '_self';

                                hrefAttr = `href="${item.link}" target="${target}"`;
                                styleAttr = 'style="cursor:pointer; display:block; text-decoration:none;"';
                            }
                            // --------------------------------------------

                            const html = `
                        <${tag} ${hrefAttr} ${styleAttr} class="banner-slide ${activeClass}" data-index="${index}">
                            <img src="${item.img}" alt="Banner ${index + 1}">
                            ${item.caption ? `<div class="banner-caption">${item.caption}</div>` : ''}
                        </${tag}>
                    `;
                            track.innerHTML += html;
                        });

                        // Jalankan Auto Slide (Tetap pakai fungsi kamu)
                        if (data.length > 1) startSlider();
                    }

                } catch (err) {
                    console.error("Gagal muat banner:", err);
                    container.style.display = 'none';
                }
            }


            // Logika Auto Slide (Fade Effect)
            function startSlider() {
                const slides = document.querySelectorAll('.banner-slide');
                let current = 0;

                setInterval(() => {
                    // Sembunyikan yg sekarang
                    slides[current].classList.remove('active');

                    // Pindah ke selanjutnya
                    current = (current + 1) % slides.length;

                    // Munculkan yg baru
                    slides[current].classList.add('active');
                }, 5000); // Ganti tiap 5 Detik
            }

            // JALANKAN!
            loadBanner();
        });




        // --- 2. SISTEM RENDER & LOAD MORE (INTI BARU) ---

        // Reset layar sebelum menampilkan hasil baru (misal habis search)
        function resetRender() {
            const container = document.getElementById('news-container');
            container.innerHTML = ""; // Bersihkan layar
            currentIndex = 0;         // Reset hitungan

            // Hapus tombol load more lama jika ada
            const oldBtn = document.getElementById('btn-load-more');
            if (oldBtn) oldBtn.remove();

            if (activeData.length === 0) {
                container.innerHTML = `<div class="no-data">Tidak ditemukan berita.</div>`;
                return;
            }

            loadNextBatch(); // Muat 9 pertama
        }

        // Muat 9 berita berikutnya
        function loadNextBatch() {
            const container = document.getElementById('news-container');
            const batch = activeData.slice(currentIndex, currentIndex + BATCH_SIZE);

            batch.forEach(item => {
                const html = createCardHTML(item);
                container.insertAdjacentHTML('beforeend', html);
            });

            currentIndex += BATCH_SIZE;
            manageLoadMoreButton(); // Cek perlu tombol lagi gak?
        }

        // Atur tombol "Muat Lebih Banyak"
        function manageLoadMoreButton() {
            const oldBtn = document.getElementById('btn-load-more');
            if (oldBtn) oldBtn.remove(); // Hapus dulu biar gak numpuk

            // Jika masih ada sisa berita yang belum tampil
            if (currentIndex < activeData.length) {
                const btnHTML = `
                <div id="btn-load-more" style="text-align:center; margin-top:30px; width:100%; grid-column: 1/-1;">
                    <button onclick="loadNextBatch()" style="
                        background:white; border:1px solid #ccc; padding:10px 30px; 
                        border-radius:50px; cursor:pointer; font-weight:bold; color:#555;
                        transition:0.3s; font-family:'Lato', sans-serif;">
                        MUAT LEBIH BANYAK ↓
                    </button>
                </div>
            `;
                document.getElementById('news-container').insertAdjacentHTML('afterend', btnHTML);
            }
        }

        // Template HTML Kartu Berita (DENGAN TOMBOL SIMPAN & BACA)
        function createCardHTML(item) {
            const judul = getVal(item, 'judul') || getVal(item, 'title');
            if (!judul) return "";

            const isi = getVal(item, 'isi') || getVal(item, 'content') || "Tidak ada detail.";
            const tanggal = getVal(item, 'tanggal') || getVal(item, 'date');
            const kategori = getVal(item, 'kategori') || 'News';
            let gambar = getVal(item, 'gambar') || getVal(item, 'image');

            if (!gambar || gambar.length < 5) gambar = "https://via.placeholder.com/600x400?text=MQ+News";

            // Escape string biar aman pas dikirim ke fungsi
            const safeJudul = (judul || "").replace(/["']/g, "").replace(/\n/g, " ");
            const safeIsi = (isi || "").replace(/["']/g, "").replace(/\n/g, " ").substring(0, 150);

            // Encode Judul
            const targetUrl = 'baca.html?title=' + encodeURIComponent(judul);

            return `
            <article class="news-card">
                <div class="card-img-wrap">
                    <img src="${gambar}" class="card-img" loading="lazy" onerror="this.src='https://via.placeholder.com/600x400?text=Image+Error'" onclick="handleArticleClick('${targetUrl}')" style="cursor:pointer">
                </div>
                <div class="card-body">
                    <div class="card-category-badge">${kategori}</div>
                    <h3 class="card-title" onclick="handleArticleClick('${targetUrl}')" style="cursor: pointer">${judul}</h3>
                    <p class="card-excerpt">${isi.substring(0, 100)}...</p>
                    <div class="card-footer">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <span class="card-date">${tanggal}</span>
                            
                            <button onclick="saveNews('${safeJudul}', '${safeIsi}', '${gambar}', '${targetUrl}', '${tanggal}', event)" 
                                    style="background:none; border:none; cursor:pointer; padding:5px; color:var(--text); transition:0.2s;"
                                    title="Simpan Berita">
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                                </svg>
                            </button>
                        </div>

                        <a onclick="handleArticleClick('${targetUrl}')" class="read-btn" href="javascript:void(0)">BACA →</a>
                    </div>
                </div>
            </article>`;
        }


        // --- 3. FITUR SEARCH & KATEGORI (DIUPDATE UNTUK LOAD MORE) ---
        function setCategory(el, cat) {
            // UI Update
            currentFilter = cat;
            document.querySelectorAll('.cat-link').forEach(link => link.classList.remove('active'));
            if (el) el.classList.add('active');
            else document.querySelectorAll('.cat-link').forEach(l => { if (l.innerText.toUpperCase() === cat.toUpperCase()) l.classList.add('active') });
            document.getElementById('current-category-label').innerText = cat === 'Semua' ? 'Berita Terkini' : cat;

            window.scrollTo({ top: 0, behavior: 'smooth' });

            // FILTER DATA (Masuk ke activeData)
            if (cat === 'Semua') {
                activeData = allNews.slice().reverse();
            } else {
                activeData = allNews.filter(i => (getVal(i, 'kategori') || '').toLowerCase().includes(cat.toLowerCase().trim())).slice().reverse();
            }

            // RENDER ULANG (Reset ke 9 awal)
            resetRender();
        }

        function executeSearch() {
            const key = document.getElementById('searchInput').value.toLowerCase();

            // FILTER DATA BERDASARKAN KEYWORD
            if (!key.trim()) {
                activeData = allNews.slice().reverse();
                document.getElementById('current-category-label').innerText = "Berita Terkini";
            } else {
                activeData = allNews.filter(i =>
                    (getVal(i, 'judul') || '').toLowerCase().includes(key) ||
                    (getVal(i, 'isi') || '').toLowerCase().includes(key)
                );
                document.getElementById('current-category-label').innerText = `Hasil Cari: "${key}"`;
            }

            // Tutup sidebar setelah search
            if (document.getElementById('sidebar').classList.contains('active')) toggleSidebar();

            // RENDER ULANG HASIL CARI (Reset ke 9 awal)
            resetRender();

            setTimeout(() => { document.getElementById('mainContainer').scrollIntoView({ behavior: 'smooth' }); }, 100);
            document.getElementById('searchInput').blur();
            document.getElementById('searchInput').value = "";
        }

        // --- 4. NAVIGASI (BACK BUTTON & SIDEBAR) ---

        // Toggle Sidebar (Logic Stack: Buka=Push, Tutup=Back)
        function toggleSidebar() {
            const sb = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const toggleBtn = document.querySelector('.menu-toggle');

            if (sb.classList.contains('active')) {
                sb.classList.remove('active');
                overlay.classList.remove('active');
                toggleBtn.classList.remove('active');
            } else {
                sb.classList.add('active');
                overlay.classList.add('active');
                toggleBtn.classList.add('active');
            }
        }
        window.toggleSidebar = toggleSidebar;


        const getVal = (item, key) => {
            const foundKey = Object.keys(item).find(k => k.toLowerCase() === key.toLowerCase());
            return foundKey ? item[foundKey] : "";
        };

        function handleEnterKey(e) { if (e.key === 'Enter') { e.preventDefault(); executeSearch(); } }

        // --- GLOBAL FUNCTIONS (Harus di-bind ke window karena module) ---

        // 1. Save News (Real Logic)
        window.saveNews = function (judul, isi, gambar, url, tanggal, e) {
            e.stopPropagation();
            e.preventDefault();

            // Ambil data lama
            let saved = JSON.parse(localStorage.getItem('mq_saved_news')) || [];

            // Cek Duplikat
            if (saved.some(x => x.judul === judul)) {
                showNotif('Berita sudah tersimpan!', 'error');
                return;
            }

            // Simpan
            saved.push({
                judul,
                isi,
                gambar,
                url,
                tanggal,
                dateAdded: new Date().toISOString()
            });

            localStorage.setItem('mq_saved_news', JSON.stringify(saved));
            showNotif('Berita berhasil disimpan!', 'success');
        };

        // 2. Handle Article Click (Guest Limit)
        window.handleArticleClick = function (url) {
            // Tunggu sebentar sampai auth siap jika belum (opsional, tapi sederhananya kita cek window.auth)
            // Note: window.auth diset oleh script module.
            const user = window.auth ? window.auth.currentUser : null;

            // Kalo user login, gas terus
            if (user) {
                window.location.href = url;
                return;
            }

            // Kalo tamu, cek kuota
            let count = parseInt(localStorage.getItem('guest_read_count') || '0');

            // Batas 3 artikel. Jika sudah 3, pas mau baca ke-4 ditolak.
            // (Asumsi saat baca artikel, counter nambah. Jadi misal baca 1, count=1. Baca 3, count=3. Next click -> 3>=3 -> Block)
            if (count >= 3) {
                document.getElementById('limitModal').style.display = 'flex';
            } else {
                window.location.href = url;
            }
        };

        // 3. Show Notification
        function showNotif(message, type) {
            const box = document.getElementById('notifBox');
            const text = document.getElementById('notifText');
            const iconDiv = document.getElementById('notifIcon');

            text.innerText = message;
            box.className = "custom-notif active";

            if (type === 'success') {
                box.classList.add('success');
                iconDiv.innerHTML = `<svg style="width:24px;height:24px;fill:#2e7d32" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>`;
            } else {
                box.classList.add('error');
                iconDiv.innerHTML = `<svg style="width:24px;height:24px;fill:#d32f2f" viewBox="0 0 24 24"><path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"/></svg>`;
            }

            setTimeout(() => {
                box.classList.remove('active');
                box.classList.remove('success');
                box.classList.remove('error');
            }, 3000);
        }
        window.showNotif = showNotif;


        // 4. PWA Install Logic (Dengan Notif Konsisten)
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // Tampilkan tombol Install di menu "Lainnya"
            const btn = document.getElementById('installBtn');
            if (btn) {
                btn.onclick = async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;

                        if (outcome === 'accepted') {
                            showNotif("Sedang memproses instalasi...", "success");
                        } else {
                            showNotif("Instalasi dibatalkan.", "error");
                        }
                        deferredPrompt = null;
                    } else {
                        // Kasus langka: prompt hilang atau sudah diinstall
                        showNotif("Aplikasi mungkin sudah terinstall.", "error");
                    }
                };
            }
        });

        // Event saat sukses install
        window.addEventListener('appinstalled', () => {
            deferredPrompt = null;
            showNotif("Aplikasi BERHASIL diinstall!", "success");

            // Sembunyikan tombol kalau perlu
            const btn = document.getElementById('installBtn');
            if (btn) btn.style.display = 'none';
        });

        // --- [BARU] FUNGSI RENDER REKOMENDASI ---
        function renderRelatedNews(containerID, excludeTitle = null) {
            const container = document.getElementById(containerID);
            if (!container) return;

            container.innerHTML = ""; // Bersihkan dulu

            // 1. Filter berita (supaya berita yg lagi dibaca gak muncul di rekomendasi)
            let candidates = allNews.filter(item => {
                const t = getVal(item, 'judul') || getVal(item, 'title');
                return t !== excludeTitle;
            });

            // 2. Acak Urutan (Shuffle) biar yang muncul beda-beda
            candidates.sort(() => 0.5 - Math.random());

            // 3. Ambil 5 Berita Saja (Terbaru)
            const selected = candidates.slice(0, 5);

            // 4. Render ke HTML
            selected.forEach(item => {
                const judul = getVal(item, 'judul') || getVal(item, 'title');
                const tanggal = getVal(item, 'tanggal') || getVal(item, 'date');

                // FIX GAMBAR
                let gambar = getVal(item, 'gambar') || getVal(item, 'image');
                if (!gambar || gambar.length < 5) gambar = "https://via.placeholder.com/100x75?text=MQ";

                const targetUrl = 'mimpi.html?title=' + encodeURIComponent(judul);

                const html = `
                 <a href="${targetUrl}" class="dream-card">
                     <div class="dream-thumb">
                         <img src="${gambar}" style="width:100%; height:100%; object-fit:cover;" loading="lazy">
                         <div class="play-overlay">
                            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
                         </div>
                     </div>
                     <div class="dream-info">
                         <h4 class="dream-title">${judul}</h4>
                         <span class="dream-date">${tanggal}</span>
                     </div>
                 </a>
             `;
                container.insertAdjacentHTML('beforeend', html);
            });

            // 5. Tambahkan Tombol "LIHAT SEMUA" di Akhir
            const viewAllHtml = `
                <a href="pramimpi.html" class="view-all-card">
                    <svg class="view-all-icon" viewBox="0 0 24 24">
                        <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span class="view-all-text">LIHAT<br>SEMUA</span>
                </a>
            `;
            container.insertAdjacentHTML('beforeend', viewAllHtml);
        }

        // Fungsi Toggle More (Menu 4 Kotak)
        function toggleMoreMenu() {
            const hiddenRows = document.querySelectorAll('.hidden-row');
            const icon = document.getElementById('iconMore');
            const text = document.getElementById('textMore');

            // Cek apakah lagi ngebuka atau nutup?
            // Kita cek salah satu item aja. Kalau hidden, berarti mau BUKA.
            const isOpening = hiddenRows[0].style.display !== 'flex';

            hiddenRows.forEach(row => {
                row.style.display = isOpening ? 'flex' : 'none';
            });

            // Ganti Icon & Teks
            if (isOpening) {
                text.innerText = "TUTUP";
                icon.innerHTML = '<path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>';
                // ^ Icon Silang (X)
            } else {
                text.innerText = "LAINNYA";
                icon.innerHTML = '<rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect>';
                // ^ Icon Kotak 4 (Default)
            }
        }

        // Jalankan init
        init();

    </script>
</body>

</html>