<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Meta Tags standard and SEO -->
    <meta name="description"
        content="Portal Berita & Informasi Terpercaya - Menyajikan berita terkini, geopolitik, eskatologi, mimpi Muhammad Qasim, dan informasi penting lainnya.">
    <meta name="keywords"
        content="berita terkini, geopolitik, eskatologi, muhammad qasim, mimpi qasim, akhir zaman, berita islam, news today">
    <meta name="author" content="MQ News Today">

    <!-- Open Graph for Social Media -->
    <meta property="og:title" content="MQ News Today - Truth & Clarity">
    <meta property="og:description"
        content="Portal Berita Terpercaya seputar Geopolitik, Eskatologi, dan Berita Dunia Islam.">
    <meta property="og:image" content="https://mqnewstoday.com/ALT_LogoMQN.png">
    <meta property="og:url" content="https://mqnewstoday.com">
    <meta property="og:type" content="website">

    <title>MQ News Today - Truth & Clarity</title>

    <link rel="icon" href="ALT_LogoMQN.png" type="image/png">
    <link rel="shortcut icon" href="ALT_LogoMQN.png" type="image/png">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Lato:wght@300;400;700&display=swap"
        rel="stylesheet">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Theme CSS -->
    <link rel="stylesheet" href="theme.css">

    <style>
        /* CSS RESET & VARS di theme.css */

        /* Override / Custom Styles Specific to Index */
        body {
            background-color: var(--bg);
            color: var(--text);
            padding-top: 60px;
            /* Space for Header */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- SKELETON LOADING --- */
        .skeleton {
            background: #e0e0e0;
            border-radius: 4px;
            animation: pulse 1.5s infinite ease-in-out;
        }

        .dark-mode .skeleton {
            background: #2d2d2d;
        }

        @keyframes pulse {
            0% {
                opacity: 0.6;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 0.6;
            }
        }

        /* --- CARD STYLES --- */
        /* See specific styles below in JS rendering or global overrides */

        .card-img-wrap {
            position: relative;
            width: 100%;
            overflow: hidden;
            background: #eee;
        }

        .card-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .news-card:hover .card-img {
            transform: scale(1.05);
            /* Zoom Effect */
        }

        .card-category-float {
            position: absolute;
            top: 8px;
            left: 8px;
            z-index: 5;
            background: var(--primary);
            color: #fff;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
            letter-spacing: 0.5px;
        }

        .card-body {
            padding: 12px !important;
            /* Reduced Padding */
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .card-title {
            font-size: 0.95rem !important;
            font-weight: 700;
            line-height: 1.4;
            margin: 0 0 10px 0 !important;
            /* TRUNCATE MULTI LINE */
            display: -webkit-box;
            -webkit-line-clamp: 3;
            line-clamp: 3;
            /* Max 3 Baris */
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-footer {
            margin-top: auto;
            /* Push to bottom */
            padding-top: 10px;
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-date {
            font-size: 0.75rem !important;
            color: #888;
        }

        .read-btn {
            font-size: 0.75rem !important;
            padding: 4px 10px !important;
        }

        /* Custom Auth Buttons Sidebar */
        .auth-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            margin-top: 10px;
            transition: 0.2s;
            cursor: pointer;
            box-sizing: border-box;
        }

        .auth-btn svg {
            stroke-width: 2.5;
        }

        .auth-btn.primary {
            background: var(--primary);
            color: #fff;
            border: none;
        }

        .auth-btn.primary:hover {
            opacity: 0.9;
        }

        .auth-btn.danger {
            background: rgba(229, 57, 53, 0.1);
            color: #e53935;
            border: 1px solid rgba(229, 57, 53, 0.3);
            margin-bottom: 5px;
        }

        .auth-btn.danger:hover {
            background: rgba(229, 57, 53, 0.2);
        }

        .auth-bottom-wrapper {
            padding: 15px;
            border-top: 1px solid var(--border);
            margin-top: auto;
        }

        /* --- COMPACT NEWS CARD DESIGN (OVERRIDE) --- */
        .news-card {
            display: flex;
            flex-direction: column;
            height: 100%;
            /* Uniform Height */
            border-radius: 8px;
            overflow: hidden;
            background: var(--bg-card);
            border: 1px solid var(--border);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
            /* Pastikan dia menuhin sisa ruang */
        }
    </style>
</head>

<body>
    <!-- ADSENSE SLOT LEFT (Desktop Only) -->
    <div class="ad-skyscraper ad-left">
        <!-- Google AdSense Script Here -->
    </div>

    <!-- ADSENSE SLOT RIGHT (Desktop Only) -->
    <div class="ad-skyscraper ad-right">
        <!-- Google AdSense Script Here -->
    </div>
    <script src="theme-init.js"></script>
    <header>

        <div class="brand">
            <img src="ALT_LogoMQN.png" alt="Logo MQ" onerror="this.style.display='none'">
            <div class="brand-text">
                <h1>MQ News Today</h1>
                <span>Truth & Clarity</span>
            </div>
        </div>
        <div class="menu-toggle" onclick="toggleSidebar()">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </header>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="settings.html" class="settings-icon-btn" title="Pengaturan">
                <svg viewBox="0 0 24 24" width="22" height="22" stroke="currentColor" stroke-width="2" fill="none"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path
                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                    </path>
                </svg>
            </a>
            <div class="search-box">
                <svg class="search-icon" viewBox="0 0 24 24" onclick="executeSearch()" title="Cari Berita">
                    <path
                        d="M21.71 20.29l-5.01-5.01C17.54 13.68 18 11.91 18 10c0-4.41-3.59-8-8-8S2 5.59 2 10s3.59 8 8 8c1.91 0 3.68-.46 5.28-1.3l5.01 5.01c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.42zM4 10c0-3.31 2.69-6 6-6s6 2.69 6 6-2.69 6-6 6-6-2.69-6-6z" />
                </svg>
                <input type="text" id="searchInput" class="search-input" placeholder="Cari..."
                    onkeypress="handleEnterKey(event)">
            </div>
            <div class="close-sidebar-btn" onclick="toggleSidebar()">&times;</div>
        </div>

        <div class="sidebar-menu">
            <!-- MENU UTAMA DROPDOWN -->
            <div class="sidebar-dropdown-wrapper" id="menu-utama-dropdown">
                <div class="sidebar-dropdown-header" onclick="toggleDropdown('menu-utama-dropdown')">
                    <span>MENU UTAMA</span>
                    <span class="sidebar-arrow">&rsaquo;</span>
                </div>
                <div class="sidebar-submenu">
                    <a href="#" onclick="toggleSidebar(); setCategory(null, 'Semua')">BERANDA</a>
                    <a href="buku.html">PDF</a>
                    <a href="pesan-tauhid.html">19 PESAN</a>
                    <a href="audio.html">AUDIO</a>
                    <a href="simpan.html">BOOKMARK</a>
                    <a href="pramimpi.html">MUBASYIRAT</a>
                </div>
            </div>
            <!-- DROPDOWN WRAPPER -->
            <div class="sidebar-dropdown-wrapper" id="mq-official-dropdown">
                <div class="sidebar-dropdown-header" onclick="toggleDropdown('mq-official-dropdown')">
                    <span>MUHAMMAD QASIM OFFICIAL</span>
                    <span class="sidebar-arrow">&rsaquo;</span>
                    <!-- Menggunakan simbol yang sama dengan hover tapi diputar nanti -->
                </div>
                <div class="sidebar-submenu">
                    <a href="https://muhammadqasimpk.org/id" target="_blank">MUHAMMAD QASIM PK</a>
                    <a href="https://muhammadqasimpk.org/id/video-dan-wawancara-id/" target="_blank">PIDATO &
                        WAWANCARA</a>
                    <a href="https://muhammadqasimpk.org/id/siaran-akhbar/" target="_blank">SIARAN AKBAR</a>
                    <a href="https://muhammadqasimpk.org/id/mimpi-yang-telah-menjadi-kenyataan/" target="_blank">MIMPI
                        JADI KENYATAAN</a>
                </div>
            </div>

            <!-- MUKJIZAT DROPDOWN -->
            <div class="sidebar-dropdown-wrapper" id="mukjizat-dropdown">
                <div class="sidebar-dropdown-header" onclick="toggleDropdown('mukjizat-dropdown')">
                    <span>MUKJIZAT</span>
                    <span class="sidebar-arrow">&rsaquo;</span>
                </div>
                <div class="sidebar-submenu">
                    <a href="https://casereportsinregrowth.com" target="_blank">CASE REPORTS</a>
                    <a href="transformasi.html?category=HAIR%20REGROWTH">HAIR REGROWTH</a>
                    <a href="transformasi.html?category=FOOT%20ELONGATION">FOOT ELONGATION</a>
                    <a href="transformasi.html?category=FEET%20INCREASE">FEET INCREASE</a>
                </div>
            </div>
            <!-- OTHERS DROPDOWN -->
            <div class="sidebar-dropdown-wrapper" id="others-dropdown">
                <div class="sidebar-dropdown-header" onclick="toggleDropdown('others-dropdown')">
                    <span>OTHERS</span>
                    <span class="sidebar-arrow">&rsaquo;</span>
                </div>
                <div class="sidebar-submenu">
                    <a href="https://saweria.co/mqnewstoday" target="_blank">SUPPORT ME</a>
                    <a href="https://chat.whatsapp.com/Cb6nVjlAtj06JRdeFzRpKw" target="_blank">BERGABUNG KE GRUP</a>
                    <a href="https://wa.me/6285705856030" target="_blank">KONTAK KAMI</a>
                    <a href="tentang-kami.html">TENTANG KAMI</a>
                    <a href="privacy-policy.html">KEBIJAKAN PRIVASI</a>
                    <a href="disclaimer.html">DISCLAIMER</a>
                    <a href="terms.html">SYARAT & KETENTUAN</a>
                </div>
            </div>
        </div>

        <div class="auth-bottom-wrapper">
            <!-- Logout (Hidden by default) -->
            <a href="#" id="logout-btn" class="auth-btn danger" style="display: none;" onclick="return false;">
                <!-- Icon Pintu Keluar -->
                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                <span>KELUAR</span>
            </a>

            <!-- Login/Profile -->
            <a href="login.html" id="auth-link" class="auth-btn primary">
                <!-- Icon Kartu ID (Inanimate) -->
                <svg id="auth-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor"
                    stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="16" rx="2"></rect>
                    <line x1="7" y1="8" x2="17" y2="8"></line>
                    <line x1="7" y1="12" x2="17" y2="12"></line>
                    <line x1="7" y1="16" x2="17" y2="16"></line>
                </svg>
                <span id="auth-text">MASUK / DAFTAR</span>
            </a>
        </div>
    </div>

    <!-- SIDEBAR OVERLAY -->
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>



    <!-- CUSTOM NOTIFICATION BOX -->
    <div id="notifBox" class="custom-notif">
        <div id="notifIcon" class="notif-icon"></div>
        <span id="notifText" class="notif-text">Pesan notifikasi...</span>
    </div>

    <div id="home-view">
        <div class="category-nav">
            <div class="nav-inner" id="nav-container">
                <a onclick="setCategory(null, 'Semua')" class="cat-link active">Semua</a>
                <a onclick="setCategory(null, 'Geopolitik')" class="cat-link">Geopolitik</a>
                <a onclick="setCategory(null, 'Eskatologi')" class="cat-link">Eskatologi</a>
                <a onclick="setCategory(null, 'Mimpi Qasim')" class="cat-link">Mimpi Qasim</a>
                <a onclick="setCategory(null, 'Timur Tengah')" class="cat-link">Timur Tengah</a>
                <a onclick="setCategory(null, 'Trending')" class="cat-link">Trending</a>
            </div>
        </div>

        <div class="date-header-container">
            <div id="live-date" class="live-date-text">Memuat Waktu...</div>

            <svg class="date-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z" />
            </svg>
        </div>





        <!-- BANNER SECTION (WRAPPED FOR ALIGNMENT) -->
        <div class="main-container" style="padding: 0; margin-bottom: 20px;">
            <div id="banner-container" class="showcase-wrapper" style="display: none;">
                <div class="showcase-strip" id="banner-track">
                </div>
            </div>
        </div>

        <div class="quick-menu-grid">

            <a href="buku.html" class="menu-item">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                    </svg>
                </div>
                <span class="menu-label">PDF</span>
            </a>

            <a href="pesan-tauhid.html" class="menu-item">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                    </svg>
                </div>
                <span class="menu-label">19 PESAN</span>
            </a>

            <a href="audio.html" class="menu-item">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
                        <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3z"></path>
                        <path d="M3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>
                    </svg>
                </div>
                <span class="menu-label">AUDIO</span>
            </a>


            <button class="menu-item" onclick="toggleMoreMenu()" id="btnMore">
                <div class="icon-box">
                    <svg id="iconMore" viewBox="0 0 24 24">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                </div>
                <span class="menu-label" id="textMore">LAINNYA</span>
            </button>

            <a href="simpan.html" class="menu-item hidden-row">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                    </svg>
                </div>
                <span class="menu-label">TERSIMPAN</span>
            </a>

            <!-- MUBASYIRAT (Pindah ke Hidden Row) -->
            <a href="pramimpi.html" class="menu-item hidden-row">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z">
                        </path>
                    </svg>
                </div>
                <span class="menu-label">MUBASYIRAT</span>
            </a>

            <a href="https://chat.whatsapp.com/Cb6nVjlAtj06JRdeFzRpKw" class="menu-item hidden-row">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                </div>
                <span class="menu-label">JOIN GRUP</span>
            </a>

            <button class="menu-item hidden-row" id="installBtn">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </div>
                <span class="menu-label">INSTALL APP</span>
            </button>

            <a href="https://saweria.co/mqnewstoday" target="_blank" class="menu-item hidden-row">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path d="M18 8h1a4 4 0 0 1 0 8h-1"></path>
                        <path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path>
                        <line x1="6" y1="1" x2="6" y2="4"></line>
                        <line x1="10" y1="1" x2="10" y2="4"></line>
                        <line x1="14" y1="1" x2="14" y2="4"></line>
                    </svg>
                </div>
                <span class="menu-label">SAWERIA</span>
            </a>

            <a href="transformasi.html" class="menu-item hidden-row">
                <div class="icon-box">
                    <svg viewBox="0 0 24 24">
                        <path
                            d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                        </path>
                    </svg>
                </div>
                <span class="menu-label">TRANSFORMASI</span>
            </a>

        </div>



        <div id="mq-quote-widget" class="mq-quote-compact" style="display:none;">
            <div class="quote-label">QUOTES OF THE END TIMES</div>

            <blockquote id="mq-quote-text">Loading...</blockquote>

            <div id="mq-quote-source">-- --</div>
        </div>





        <main class="main-container" id="mainContainer">

            <div class="section-label">
                <span id="current-category-label">Berita Terkini</span>
                <div class="section-line"></div>
            </div>

            <!-- Loader -->
            <div id="loader" class="loader"></div>

            <!-- News Grid -->
            <div id="news-container" class="news-grid">
                <!-- Data akan dirender di sini via JS -->
            </div>

        </main>
    </div>

    <!-- TENTANG KAMI, WA, dll di footer? User tidak minta. -->

    <div class="footer-simple">
        &copy; 2025 MQ News Today. All rights reserved.
    </div>

    <!-- MODAL LOGOUT -->
    <div class="logout-modal" id="logoutModal">
        <div class="modal-content">
            <h3 class="modal-title">Konfirmasi Keluar</h3>
            <p class="modal-desc">Anda yakin ingin keluar dari akun?</p>
            <div class="modal-actions">
                <button class="btn-cancel" id="btnCancelLogout">Batal</button>
                <button class="btn-confirm" id="btnConfirmLogout">Keluar</button>
            </div>
        </div>
    </div>

    <!-- FIREBASE SCRIPTS -->
    <script type="module">
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { app } from "./firebase-config.js";

        const auth = getAuth(app);

        // UI ELEMENTS
        const authLink = document.getElementById('auth-link');
        const authIcon = document.getElementById('auth-icon');
        const authText = document.getElementById('auth-text');
        const logoutBtn = document.getElementById('logout-btn');

        // CHECK AUTH STATE
        onAuthStateChanged(auth, (user) => {
            const link = document.getElementById('auth-link');
            const text = document.getElementById('auth-text');


            if (user) {
                // USER LOGIN
                text.innerText = "PROFIL SAYA";
                link.href = "profil.html"; // Arahkan ke profil

                if (logoutBtn) {
                    logoutBtn.style.display = "flex";
                    logoutBtn.onclick = (e) => {
                        e.preventDefault();
                        document.getElementById('logoutModal').classList.add('active');
                    };
                }
            } else {
                // USER LOGOUT
                text.innerText = "MASUK / DAFTAR";
                link.href = "login.html";
                if (logoutBtn) logoutBtn.style.display = "none";
            }
        });

        // LOGOUT LOGIC
        document.getElementById('btnConfirmLogout').addEventListener('click', async () => {
            // FIX: Reset limit baca tamu saat logout agar user mulai dari 0 lagi sebagai tamu
            localStorage.removeItem('guest_read_count');
            sessionStorage.removeItem('last_read_url');

            await signOut(auth);
            document.getElementById('logoutModal').classList.remove('active');
            window.location.reload();
        });

        document.getElementById('btnCancelLogout').addEventListener('click', () => {
            document.getElementById('logoutModal').classList.remove('active');
        });
    </script>

    <script>
        // --- KONFIGURASI ---
        const sheetID = "1FDzhBlVOFlnlQgphN2gsGJUdDeFWonpoJcadY8JqUcM";

        // Variabel Global
        var allNews = [];         // Semua berita mentah dari CSV
        let activeData = [];      // Berita yang sedang aktif (bisa hasil search/filter)
        let currentPage = 1;      // Halaman aktif sekarang
        const BATCH_SIZE = 6;     // Jumlah berita per halaman (6 berita)

        // --- 1. INIT: AMBIL DATA ---
        // --- 1. INIT: AMBIL DATA ---
        async function init() {
            // Updated to use the specific published CSV link provided by the user
            const rawUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTOAltvE7tpJsTkKbqMoqLZe-7K9cGk_uPUqeigV7qvWUm5crdAiOJ_hNAvchnjNrE8cA0F-ybuZhKd/pub?gid=0&single=true&output=csv";
            const url = rawUrl + "&t=" + Date.now(); // Cache Buster

            try {
                // Fetch with explicit cache control
                const response = await fetch(url, { cache: "no-store" });
                if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                const text = await response.text();

                Papa.parse(text, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function (results) {
                        try {
                            if (results.data && results.data.length > 0) {
                                allNews = results.data.filter(item => {
                                    const judul = getVal(item, 'judul') || getVal(item, 'title');
                                    return judul && judul.trim() !== "";
                                });

                                // REVERSE: Berita terbaru di atas (asumsi data sheet urut kronologis input)
                                allNews.reverse();

                                activeData = allNews; // Default: tampilkan semua
                                renderPage(1);        // Render halaman 1
                                document.getElementById('loader').style.display = 'none';

                                // AUTO-LOAD WIDGET (Panggil fungsi widget setelah data siap)
                                if (typeof loadRandomQuote === 'function') {
                                    loadRandomQuote();
                                }
                            } else {
                                document.getElementById('news-container').innerHTML = '<div class="no-data">Tidak ada berita ditemukan.</div>';
                                document.getElementById('loader').style.display = 'none';
                            }
                        } catch (err) {
                            console.error("Error processing data:", err);
                            document.getElementById('news-container').innerHTML = '<div class="no-data">Gagal memproses data.</div>';
                            document.getElementById('loader').style.display = 'none';
                        }
                    },
                    error: function (err) {
                        console.error("Papa Parse Error:", err);
                        document.getElementById('news-container').innerHTML = '<div class="no-data">Gagal membaca data CSV.</div>';
                        document.getElementById('loader').style.display = 'none';
                    }
                });
            } catch (error) {
                console.error("Fetch Error:", error);
                document.getElementById('news-container').innerHTML = '<div class="no-data">Gagal mengambil data dari server. Periksa koneksi internet Anda.</div>';
                document.getElementById('loader').style.display = 'none';
            }
        }

        // Helper biar aman ambil key (case-insensitive & trim)
        function getVal(item, keyName) {
            const lowerKey = keyName.toLowerCase();
            const foundKey = Object.keys(item).find(k => k.toLowerCase().includes(lowerKey));
            return foundKey ? item[foundKey] : "";
        }

        // --- 2. RENDER & PAGINATION LOGIC ---

        // Fungsi Ganti Kategori
        window.setCategory = function (element, category) {
            // Update Active Style
            document.querySelectorAll('.cat-link').forEach(el => el.classList.remove('active'));
            if (element) {
                element.classList.add('active');
            } else {
                // Kalo dipanggil manual (misal dari sidebar), cari elemen yg cocok
                const target = Array.from(document.querySelectorAll('.cat-link')).find(el => el.innerText === category);
                if (target) target.classList.add('active');
            }

            // Update Label
            const labelEl = document.getElementById('current-category-label');
            if (labelEl) labelEl.innerText = category === 'Semua' ? 'Berita Terkini' : category;

            // Filter Data
            if (category === 'Semua') {
                activeData = allNews;
            } else {
                activeData = allNews.filter(item => {
                    const cat = getVal(item, 'kategori') || "";
                    return cat.toLowerCase().includes(category.toLowerCase());
                });
            }

            // Reset ke Halaman 1
            currentPage = 1;
            renderPage(currentPage);
        }

        // Render Halaman Tertentu
        function renderPage(page) {
            const container = document.getElementById('news-container');
            container.innerHTML = ""; // Bersihkan layar

            if (activeData.length === 0) {
                container.innerHTML = `<div class="no-data">Tidak ditemukan berita.</div>`;
                return;
            }

            // Hitung Index Start & End
            const start = (page - 1) * BATCH_SIZE;
            const end = start + BATCH_SIZE;
            const batch = activeData.slice(start, end);

            // Render Berita
            batch.forEach(item => {
                const html = createCardHTML(item);
                container.insertAdjacentHTML('beforeend', html);
            });

            // Render Pagination Control
            renderPaginationControls(page);
        }

        // Render Tombol Pagination (1, 2, 3...)
        function renderPaginationControls(page) {
            const container = document.getElementById('news-container');
            const totalPages = Math.ceil(activeData.length / BATCH_SIZE);

            if (totalPages <= 1) return; // Kalau cuma 1 halaman, gak perlu tombol

            let buttonsHTML = '';

            // Tombol Prev
            if (page > 1) {
                buttonsHTML += `<button onclick="goToPage(${page - 1})" class="page-btn" aria-label="Previous">&lsaquo;</button>`;
            }

            // Logic Smart Pagination (biar gak kepanjangan kalau halaman banyak)
            // Tampilkan: 1 ... [current-1] [current] [current+1] ... [last]
            // Tapi User request "1, 2, 3... dst". Kita kasih limit sederhana biar rapi kalo datanya ratusan.

            // Untuk sekarang kita loop semua jika < 10 halaman. Jika > 10 kita slicing.
            let startPage = 1;
            let endPage = totalPages;

            // Render Buttons
            for (let i = startPage; i <= endPage; i++) {
                const activeClass = i === page ? 'active' : '';
                buttonsHTML += `<button onclick="goToPage(${i})" class="page-btn ${activeClass}">${i}</button>`;
            }

            // Tombol Next
            if (page < totalPages) {
                buttonsHTML += `<button onclick="goToPage(${page + 1})" class="page-btn" aria-label="Next">&rsaquo;</button>`;
            }

            const wrapper = `
                <div class="pagination-wrapper">
                    ${buttonsHTML}
                </div>
            `;
            container.insertAdjacentHTML('beforeend', wrapper);
        }

        // Fungsi Pindah Halaman
        window.goToPage = function (page) {
            currentPage = page;
            renderPage(page);

            // Scroll sedikit ke atas (section label) biar UX enak
            const label = document.querySelector('.section-label');
            if (label) label.scrollIntoView({ behavior: 'smooth', block: 'start' });
        };

        // Template HTML Kartu Berita (DENGAN TOMBOL SIMPAN & BACA)
        function createCardHTML(item) {
            const judul = getVal(item, 'judul') || getVal(item, 'title');
            if (!judul) return "";

            let isi = getVal(item, 'isi') || getVal(item, 'content') || "Tidak ada detail.";

            // --- FIX: REMOVE TITLE FROM CONTENT IF REPEATED ---
            // Banyak kasus di mana data sheet 'isi' dimulai dengan 'judul'. Kita hapus biar gak double.
            if (judul && isi.toLowerCase().trim().startsWith(judul.toLowerCase().trim())) {
                isi = isi.substring(judul.length).trim();
                // Bersihkan karakter sisa di awal (misal: " - " atau ": ")
                isi = isi.replace(/^[:\-\s]+/, '');
            }
            const tanggal = getVal(item, 'tanggal') || getVal(item, 'date');
            const kategori = getVal(item, 'kategori') || 'News';
            let gambar = getVal(item, 'gambar') || getVal(item, 'image');

            if (!gambar || gambar.length < 5) gambar = "https://via.placeholder.com/600x400?text=MQ+News";

            // Escape string biar aman pas dikirim ke fungsi
            const safeJudul = (judul || "").replace(/["']/g, "").replace(/\n/g, " ");
            const safeIsi = (isi || "").replace(/["']/g, "").replace(/\n/g, " ").substring(0, 150);

            // Encode Judul
            const targetUrl = 'baca.html?title=' + encodeURIComponent(judul);

            return `
            <article class="news-card">
                <div class="card-img-wrap" style="aspect-ratio: 16/9 !important;">
                    <div class="card-category-float">${kategori}</div>
                    <img src="${gambar}" class="card-img" loading="lazy" onerror="this.src='https://via.placeholder.com/600x400?text=Image+Error'" onclick="handleArticleClick('${targetUrl}')" style="cursor:pointer">
                </div>
                <div class="card-body">
                    <h3 class="card-title" onclick="handleArticleClick('${targetUrl}')" style="cursor: pointer" title="${judul}">${judul}</h3>
                    
                    <div class="card-footer">
                        <div style="display:flex; align-items:center; gap:8px;">
                            <span class="card-date">${tanggal}</span>
                            
                            <button onclick="saveNews('${safeJudul}', '${safeIsi}', '${gambar}', '${targetUrl}', '${tanggal}', event)" 
                                    style="background:none; border:none; cursor:pointer; padding:4px; color:var(--text); transition:0.2s;"
                                    title="Simpan Berita">
                                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                                </svg>
                            </button>
                        </div>
                        <a href="baca.html?title=${encodeURIComponent(judul)}" class="read-btn">BACA &rarr;</a>
                    </div>
                </div>
            </article>
            `;
        }

        // --- HANDLE CLICK ARTIKEL (Limit Guest) ---
        window.handleArticleClick = function (targetUrl) {
            // Cek status login via Firebase Auth (tapi karena async, kita cek localStorage flag dulu biar cepet)
            // Atau kita cek session simple. Di sini kita asumsi limit baca ada di localStorage 'guest_read_count'

            // Logic:
            // 1. Kalau user login (ada auth), bebas.
            // 2. Kalau guest, cek limit.

            // Karena auth firebase butuh waktu load, kita cek elemen UI 'auth-text' (agak hacky tapi works buat MVP frontend)
            const authText = document.getElementById('auth-text');
            const isLoggedIn = authText && authText.innerText.includes('PROFIL');

            if (isLoggedIn) {
                // User member -> Lanjut
                window.location.href = targetUrl;
            } else {
                // Guest -> Cek limit
                let count = parseInt(localStorage.getItem('guest_read_count') || "0");

                if (count >= 3) {
                    // Limit habis -> Arahkan ke login tapi simpan URL biar nanti bisa redirect balik (opsional)
                    sessionStorage.setItem('last_read_url', targetUrl);
                    alert("Limit bacaan gratis Anda habis (3 artikel). Silakan login untuk akses tanpa batas.");
                    window.location.href = "login.html";
                } else {
                    // Masih ada kuota -> Tambah count, lalu lanjut
                    localStorage.setItem('guest_read_count', count + 1);
                    window.location.href = targetUrl;
                }
            }
        };

        // --- FUNGSI SAVE NEWS (Sama kayak di baca.html) ---
        window.saveNews = function (judul, isi, gambar, url, tanggal, event) {
            // Stop propagasi biar gak nge-klik kartu (masuk ke baca)
            if (event) event.stopPropagation();

            let saved = JSON.parse(localStorage.getItem('mq_saved_news')) || [];

            // Cek duplikat
            const exists = saved.some(item => item.judul === judul);

            if (exists) {
                showCustomNotif('Berita sudah tersimpan!', 'error');
            } else {
                saved.push({
                    judul: judul,
                    isi: isi,
                    gambar: gambar,
                    url: url, // Link relative
                    tanggal: tanggal,
                    dateAdded: new Date().toISOString()
                });
                localStorage.setItem('mq_saved_news', JSON.stringify(saved));
                showCustomNotif('Berita berhasil disimpan!', 'success');
            }
        };

        // Custom Notification Function
        function showCustomNotif(msg, type) {
            const notifBox = document.getElementById('notifBox');
            const notifText = document.getElementById('notifText');
            const notifIcon = document.getElementById('notifIcon');

            notifText.innerText = msg;
            notifBox.className = 'custom-notif show'; // Reset class

            if (type === 'success') {
                notifBox.classList.add('success');
                // Icon Centang
                notifIcon.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
            } else {
                notifBox.classList.add('error');
                // Icon Silang
                notifIcon.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`;
            }

            // Hide after 3s
            setTimeout(() => {
                notifBox.classList.remove('show');
            }, 3000);
        }


        // --- 3. INIT SCRIPT SEARCH (Popup Sidebar) ---
        window.handleEnterKey = function (e) {
            if (e.key === 'Enter') executeSearch();
        }

        window.executeSearch = function () {
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (!query) return;

            // Tutup sidebar (mobile UX)
            toggleSidebar();

            // Ubah Label
            document.getElementById('current-category-label').innerText = `Hasil Pencarian: "${query}"`;

            // Filter
            activeData = allNews.filter(item => {
                const judul = getVal(item, 'judul').toLowerCase();
                const isi = getVal(item, 'isi').toLowerCase();
                return judul.includes(query) || isi.includes(query);
            });

            renderPage(1);
        }


        // --- 4. TOGGLE SIDEBAR & DROPDOWN ---
        window.toggleSidebar = function () {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
        }

        window.toggleDropdown = function (id) {
            const el = document.getElementById(id);
            el.classList.toggle('active');
        }

        // --- 5. MORE MENU (QUICK MENU) ---
        window.toggleMoreMenu = function () {
            const rows = document.querySelectorAll('.hidden-row');
            const btnText = document.getElementById('textMore');
            const isHidden = rows[0].style.display === 'none' || getComputedStyle(rows[0]).display === 'none';

            if (isHidden) {
                // Show
                rows.forEach(r => r.style.display = 'flex');
                btnText.innerText = "TUTUP";
                // Animation logic handled by CSS transition if added, or simple display toggle
            } else {
                // Hide
                rows.forEach(r => r.style.display = 'none');
                btnText.innerText = "LAINNYA";
            }
        }

        // --- 6. QUOTES WIDGET LOGIC ---
        // (Copied simple logic from original index)
        const quotes = [
            { text: "Islam akan bangkit kembali dari Pakistan.", source: "Muhammad Qasim" },
            { text: "Dunia akan menyaksikan peristiwa besar yang belum pernah terjadi sebelumnya.", source: "Mubasyirat" },
            { text: "Perbanyaklah dzikir dan doa di masa-masa sulit ini.", source: "Pesan Spiritual" },
            { text: "Keadilan akan ditegakkan, dan kebatilan akan musnah.", source: "Janji Allah" }
        ];

        function loadRandomQuote() {
            const quoteEl = document.getElementById('mq-quote-text');
            const sourceEl = document.getElementById('mq-quote-source');
            const container = document.getElementById('mq-quote-widget');

            if (!quoteEl) return;

            const random = quotes[Math.floor(Math.random() * quotes.length)];
            quoteEl.innerText = `"${random.text}"`;
            sourceEl.innerText = `— ${random.source}`;
            container.style.display = 'block';
        }

        // --- 7. AUTO SLIDER LOGIC ---
        let slideIndex = 0;
        let slideInterval;

        function startSlider() {
            // console.log("Starting Slider..."); 
            slideInterval = setInterval(nextSlide, 5000); // 5 detik
        }

        function nextSlide() {
            const slides = document.querySelectorAll('.banner-slide');
            if (slides.length === 0) return;

            slides[slideIndex].classList.remove('active');
            slideIndex = (slideIndex + 1) % slides.length;
            slides[slideIndex].classList.add('active');
        }

        // Initialize Parsing
        init();

        // Load Search Recent? (Optional - skipped for clean MVP)

    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        // --- SCRIPT EDITOR CHOICE (Berita Pilihan) ---
        // Kita pakai sheet yang sama (index 0) tapi filter kategori 'Pilihan' atau ambil 3 terbaru random 
        // IMPLEMENTASI: Ambil 5 Berita Terbaru secara acak untuk widget "Editor's Choice" (Contoh)

        // NOTE: Karena user tidak minta widget khusus editor choice di layout baru ini, kita skip dulu.
        // Jika mau diaktifkan, uncomment kode di bawah.
        /*
        const loadEditorChoice = (data) => {
            const container = document.getElementById('editor-list'); 
            if(!container) return; // Kalau elemen gak ada di HTML baru

            // Ambil 5 random
            const shuffled = data.sort(() => 0.5 - Math.random()).slice(0, 5);
            
            container.innerHTML = '';
            shuffled.forEach(item => {
                const judul = getVal(item, 'judul');
                const tanggal = getVal(item, 'tanggal');
                const html = `
                <a href="baca.html?title=${encodeURIComponent(judul)}" class="editor-item">
                    <div class="editor-num">#</div>
                    <div class="editor-info">
                        <h4 class="editor-title">${judul}</h4>
                        <span class="editor-date">${tanggal}</span>
                    </div>
                </a>
                `;
                container.insertAdjacentHTML('beforeend', html);
            });
        };
        */

        // --- SCRIPT JAM REDAKSI ---
        function updateClock() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateStr = now.toLocaleDateString('id-ID', options);
            const timeStr = now.toLocaleTimeString('id-ID'); // Jam:Menit:Detik

            const el = document.getElementById('live-date');
            if (el) el.innerText = `${dateStr} | ${timeStr} WIB`;
        }
        setInterval(updateClock, 1000); // Update tiap detik
        updateClock(); // Jalanin langsung pas load

        // --- SCRIPT BANNER OTOMATIS (GOOGLE SHEET) ---
        document.addEventListener('DOMContentLoaded', () => {
            // 1. MASUKKAN LINK CSV SHEET "BANNER" LU DI SINI:
            const BANNER_SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTOAltvE7tpJsTkKbqMoqLZe-7K9cGk_uPUqeigV7qvWUm5crdAiOJ_hNAvchnjNrE8cA0F-ybuZhKd/pub?gid=530510330&single=true&output=csv";

            const container = document.getElementById('banner-container');
            const track = document.getElementById('banner-track');

            // Fungsi Parse CSV (Sama kayak berita)
            function parseCSV(text) {
                const rows = text.split('\n').slice(1); // Buang header baris 1
                return rows.map(row => {
                    // Split koma (regex ini menangani koma di dalam tanda kutip)
                    const cols = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
                    if (!cols) return null;
                    return {
                        img: cols[0]?.replace(/"/g, '').trim(),
                        caption: cols[1]?.replace(/"/g, '').trim(),
                        link: cols[2]?.replace(/"/g, '').trim()
                    };
                }).filter(item => item && item.img); // Hanya ambil yg ada gambarnya
            }

            // Fungsi Render Banner (Versi Aman & Support Link Lokal)
            async function loadBanner() {
                try {
                    const res = await fetch(BANNER_SHEET_URL);
                    const text = await res.text();
                    let data = parseCSV(text); // Tetap pakai parseCSV kamu

                    // LIMIT CUMA 3 GAMBAR
                    if (data.length > 3) data = data.slice(0, 3);

                    if (data.length > 0) {
                        // Tampilkan Container
                        container.style.display = 'block';
                        track.innerHTML = ''; // Bersihkan

                        data.forEach((item, index) => {
                            const activeClass = index === 0 ? 'active' : '';

                            // --- LOGIKA BARU: CEK LINK LOKAL vs LUAR ---
                            let tag = 'div';
                            let hrefAttr = '';
                            let styleAttr = '';

                            // Cek kolom link ada isinya gak?
                            if (item.link && item.link.trim() !== '') {
                                tag = 'a'; // Jadiin link

                                // Cek apakah link luar (http) atau lokal?
                                const target = item.link.includes('http') ? '_blank' : '_self';

                                hrefAttr = `href="${item.link}" target="${target}"`;
                                styleAttr = 'style="cursor:pointer; display:block; text-decoration:none;"';
                            }
                            // --------------------------------------------

                            const html = `
                        <${tag} ${hrefAttr} ${styleAttr} class="banner-slide ${activeClass}" data-index="${index}">
                            <img src="${item.img}" alt="Banner ${index + 1}">
                            ${item.caption ? `<div class="banner-caption">${item.caption}</div>` : ''}
                        </${tag}>
                    `;
                            track.innerHTML += html;
                        });

                        // Jalankan Auto Slide (Tetap pakai fungsi kamu)
                        if (data.length > 1) startSlider();
                    }

                } catch (err) {
                    console.error("Gagal muat banner:", err);
                    container.style.display = 'none';
                }
            }


            loadBanner();
        });
    </script>
</body>

</html>